<!DOCTYPE html>
<html>
	<head>
		<style>
			figure {display: inline-block;}
		</style>
	</head>
	<body onhashchange="changeUrl()">
	    <br>
	    <h1> Front & back end interaction Demo </h1>
	    <br>
		<a href="#orig">original</a>
		<a href="#keys">keys</a>
		<a href="#full">full</a>
		<div id="demo" style="border: 1px solid gray; min-height: 100px; min-width: 400px;"></div>
		<br>
		<script>
			var settings = {};
			settings.partialCache = {};
			settings.divDemo = document.getElementById("demo");
			settings.divDemo.style.visible = false;
			settings.apiMap = JSON.parse(loadPartial('https://api.github.com/emojis'));
			
			function changeUrl() {
				var url = location.hash.replace('#','');
				if(url === ''){
					url = 'orig';
				}
				var partial = loadPartial(url + '.html');
				divDemo.innerHTML = partial;
				execFunc(url);
				divDemo.style.visible = true;
			}
/*			var inner = '';
		    for(var key in apiMap) {
		    	console.log(key);
		    	inner += "<figure style='display: inline-block;'><img src='" + apiMap[key] + "' width='100' height='100'><figcaption>" + key + "</figcaption></figure>";
		    }
*/
			function loadPartial(href) {
			    if(! settings.partialCache[href]){			    	
		        	var xmlhttp = new XMLHttpRequest();
    				xmlhttp.open("GET", href, false);
		        	xmlhttp.send();
		        	console.log(xmlhttp);
        			settings.partialCache[href] = xmlhttp.responseText;
        		}
        		return settings.partialCache[href];
/*        		var children = divDemo.childNodes;
        		for(var i in children){
        			if(children[i].dataset){
        				if (children[i].dataset.repeat) {
        					
        				}
        			}
        		}
*/
    		}
    		function execFunc(partial) {
    			var fn = window[partial];
				if(typeof fn === 'function') {
				    fn(t);
				}
    		}
    		var orig = function(){
    			console.log('orig');
    		}
    		var keys = function(){
    			console.log('keys');
    		}
    		var full = function(){
    			console.log('full');
    		}
    		changeUrl();
		</script>
	</body>
</html>
